# Using PYRSM with Claude Desktop

This guide explains how to use PYRSM with Claude Desktop to perform statistical analysis using natural language.

## Overview

Claude Desktop can generate Python code for PYRSM based on your natural language requests, and the `claude_mcp_client.py` script helps you run that code locally on your machine. This approach gives you the benefits of Claude's code generation abilities while keeping your data and computation local.

## Setup

1. Make sure PYRSM is installed:
   ```bash
   uv pip install -e .
   ```

2. Make the client script executable:
   ```bash
   chmod +x claude_mcp_client.py
   ```

## Available Commands

The `claude_mcp_client.py` script provides several commands:

- `datasets`: List all available datasets in PYRSM
- `load [dataset]`: Load a specific dataset and display information about it
- `analyze [dataset] [question]`: Generate and save code to answer a natural language question about the data
- `run [code_file]`: Run a generated code file

## Workflow with Claude Desktop

### Step 1: Explore Available Datasets

First, see what datasets are available:

```bash
python claude_mcp_client.py datasets
```

This will display a list of all available datasets in PYRSM.

### Step 2: Load a Dataset

Load a specific dataset to see its structure:

```bash
python claude_mcp_client.py load demand_uk
```

This will display information about the dataset, including its columns, dimensions, and a sample of the data.

### Step 3: Ask Claude to Generate Analysis Code

Copy the dataset information from Step 2 and ask Claude Desktop to write code for your analysis. For example:

**Prompt to Claude:**
```
I'm working with the demand_uk dataset from PYRSM, which has these columns: [price, demand].
Can you write Python code using PYRSM to determine if demand is greater than 1750?
```

Claude will generate code that you can save to a file (e.g., `analysis.py`).

### Step 4: Run the Analysis

You can run the code generated by Claude:

```bash
python claude_mcp_client.py run analysis.py
```

Or use the client to generate and save code automatically:

```bash
python claude_mcp_client.py analyze demand_uk "Is demand greater than 1750?"
```

This will save the generated code to `claude_generated_code.py` and provide instructions for running it.

## Example Session

Here's an example session using Claude Desktop and the client script:

1. List available datasets:
   ```bash
   $ python claude_mcp_client.py datasets
   Found 25 datasets:
   --------------------------------------------------------------------------------
   NAME            ROWS     COLUMNS  DESCRIPTION                                
   --------------------------------------------------------------------------------
   demand_uk       12       2        UK electricity demand data for various prices
   titanic         891      12       Titanic passenger data with survival informat
   diamonds        53940    10       Dataset containing prices and attributes of a
   ...
   ```

2. Load a specific dataset:
   ```bash
   $ python claude_mcp_client.py load demand_uk
   Dataset: demand_uk
   Rows: 12, Columns: 2
   Description: UK electricity demand data for various prices
   
   Columns:
   - price
   - demand
   
   Sample data (first 5 rows):
        price     demand
   0    101.25    1687.97
   1    104.13    1598.02
   2    106.60    1606.29
   3    107.42    1487.72
   4    107.80    1555.95
   
   Code to load this dataset:
   --------------------------------------------------------------------------------
   import pyrsm as rsm
   demand_uk, demand_uk_description = rsm.load_data(name='demand_uk')
   --------------------------------------------------------------------------------
   ```

3. Ask Claude for analysis (paste output from step 2 to Claude with your analysis request)

4. Run the generated code:
   ```bash
   $ python claude_mcp_client.py analyze demand_uk "Is demand greater than 1750?"
   Loaded dataset: demand_uk
   Dataset: demand_uk
   Question: Is demand greater than 1750?
   Explanation: Analyzing if values in 'demand' are greater than 1750
   
   Generated code saved to: claude_generated_code.py
   Run this code with:
     python claude_generated_code.py
   
   Preview of generated code:
   --------------------------------------------------------------------------------
   
   # Check if values in 'demand' are greater than 1750
   import matplotlib.pyplot as plt
   
   # Calculate basic statistics
   column_data = demand_uk["demand"]
   mean_value = column_data.mean()
   greater_than_count = (column_data > 1750).sum()
   ...
   --------------------------------------------------------------------------------
   ```

5. Run the generated code:
   ```bash
   $ python claude_generated_code.py
   Mean of 'demand': 1582.16
   Number of values > 1750: 0 of 12
   Percentage greater than 1750: 0.00%
   ```

## Advanced Usage

### Custom Code Generation

For more complex analyses, you can ask Claude to generate code based on specific requirements and save it to a file, then run it using:

```bash
python claude_mcp_client.py run your_custom_code.py
```

### Modifying Generated Code

You can view and modify the generated code in `claude_generated_code.py` before running it to make adjustments as needed.

## Troubleshooting

- If you encounter import errors, make sure PYRSM is installed correctly with `uv pip install -e .`
- If the dataset is not found, check the spelling and try listing available datasets
- For visualization issues, make sure matplotlib is configured for your environment